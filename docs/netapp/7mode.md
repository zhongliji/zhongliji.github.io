## loader paramter modify
```
LOADER-A> printenv bootarg.init.boot_clustered
LOADER-A> setenv bootarg.init.boot_clustered false
LOADER-A> setenv bootart.init.switchless_clustered.enable false
LOADER-A> saveenv
LOADER-A> boot_ontap menu
```
## enable HA need reboot filer
```
options cf.mode ha
```
## cluster failover
```
cf status
cf enable
cf disable
cf takeover
cf giveback
```
## sp login with naroot
```
system console
```
## modify hostname rdfile wrfile /etc/rc and /etc/hosts
```
> rdfile /etc/rc   
#Auto-generated by setup Wed Jul  3 23:53:15 GMT 2019
hostname fas2240
ifconfig e0M `hostname`-e0M mtusize 1500
route add default 192.168.6.1 1
routed on
options dns.enable off
options nis.enable off
savecore
```
## last line enter to empty and ctrl+c
```
> wrfile /etc/rc  
#Auto-generated by setup Wed Jul  3 23:53:15 GMT 2019
hostname fas2240a
ifconfig e0M `hostname`-e0M mtusize 1500
route add default 192.168.6.1 1
routed on
options dns.enable off
options nis.enable off
savecore
```
## create aggr
```
aggr create aggr1 -r 3 -t raid4 6
aggr create aggr1 -r 3 -t raid4 -d 0a.03 0a.04 0a.06
aggr status -r aggr1
aggr show_space -t aggr1
aggr show_space -g aggr1
```
## extend aggr
```
aggr add aggr1 -n 2
aggr add aggr1 -d 0b.06
```
## create volume
```
vol create vol01 aggr1 1t
vol status vol01
vol size vol01
vol size vol01 +500g
vol size vol01 -500g
vol offline vol01
vol destroy vol01
```
## license add
```
license add YDPCZTXFLEGEYAAAAAAAAAAAAAAA
license add KYMRZTXFLEGEYAAAAAAAAAAAAAAA
license show
```
## nfs exports wrfile: last line enter to empty and ctrl+c
```
wrfile /etc/exports
/vol/vol01 -sec=sys,rw,nosuid,root=192.168.8.0/24
exportfs -a
exportfs -v
```
## user and group
```
useradmin group add group1
useradmin user add liyang -g group1
useradmin user list
useradmin domainuser list
useradmin whoami
```
## cifs setup
```
cifs terminate
cifs restart
timezone Asia/Shanghai
options timed.enable on
cifs setup
cifs shares
cifs shares -add vol1 /vol/vol1
rdfile /etc/usermap.cfg
cifs domaininfo
cifs access vol1 everyone no access
cifs access vol1 everyone Full control
cifs sessions
cifs shares -add qtree1 /vol/vol1/qtree1
```
## secedit.exe add everyone permission to cifs volume
```
1. /vol/data/ Untitled #on windows with secedit.exe save as unicode format
2. copy Untitled to /vol/data #on windows
3. fsecurity apply /vol/data/Untitled #on ontap
4. fsecurity show /vol/data #on ontap
```
## vol copy
```
options rsh.enable on #on two nodes
wrfile /etc/hosts.equiv #on source node write destination ip; on destination node write source ip;
vol create data agg1 4t #on destination node
vol offline data #on destination node
vol copy data 10.18.0.37:data #source node
```
## iscsi
```
options licensed_feature.iscsi.enable on
iscsi start
vol create vol01 aggr 600g
vol status vol01
lun create -s 500g -t linux /vol/vol01/lun0
lun show
iscsi interface enable -a
igroup create -i -t linux igroup01 iqn.1994-05.com.redhat:2130307ce5c0
igroup add igoup01 iqn.1994-05.com.redhat:2130307ce5c1
igroup show
lun map /vol/vol01/lun0 igroup01
lun show -m
```
## snapmirror
```
options snapmirror.enable on #on two nodes
options snapmirror.access host=192.168.6.212 #destination IP on source node
vol create vol02 agg1 200g #on destination node
vol restrict vol02 #on destination node

snapmirror initialize -k 51200 –S 10.18.0.36:vol02 fas2240b:vol02 #on destination node
snapmirror status

wrfile /etc/snapmirror.conf #on destination node
10.18.0.36:data fas2240b:data kbs=51200 - 0，30 * *

snapmirror update -S 192.168.6.211:vol02 fas2240b:vol02
snapmirror quiesce fas2240b:vol02
snapmirror resume fas2240b:vol02
snapmirror break fas2240b:vol02
snapmirror resync -S 192.168.6.211:vol02 fas2240b:vol02
snapmirror release vol02 fas2240b:vol02
```
## autosupport
```
nas3020a> priv set advanced   #退出advanced模式：priv set 
nas3020a*> options autosupport   #查看autosupport状态；
nas3020a*> options autosupport.enable on　#打开autosupport；
nas3020a*>date  #查看日期，日志文件会以日期加零命名，如：201104120006.0  
nas3020a*> options autosupport.doit /etc/log/autosupport
nas3020a*>ls /etc/log/autosupport  #查找日志文件：201104120006.0
nas3020a*>rdfile /etc/log/autosupport/201104120009.0  #读取日志文件
```
## replace MB
```
1．在secureCRT中先Transfor-----auto save #保存会话;File---log session（记录会话，保存路径）
2．做一次autosupport先； 
3．fcadmin config #查看前端后端，机头到shelf的端口都应该为initiator；
4．storage show disk -p #查看是否为singlepath还是mutipath；
5． cf status  #查看HA状态为Cluster enabled, fas3070b is up，必须先在B机头上cf takeover；
   options cf.giveback.auto.enable off
6．进入advanced模式，在机头fas3070b*> cf takeover 接管fas3070a，换A机头；
7．被更换机头会自动重启到LOADER模式：LOADER>  #这时可以进行物理更换A机头；
8．物理更换A机头，一定把连接线做好原始状态标注；把旧的compactflash更换到新机头；
9．启动更换后的新机头时Ctrl+C 进入LOADER> show time
10．LOADER> set date 04/14/2011
11．LOADER> set time 23:46:00
12．LOADER> boot_diags   #跑诊断选择MB
13．LOADER> autoboot    #进入compactflash卡的Maintenance模式；（Ctrl+C，选择：5）
14．*> fcadmin config  #查看前端后端状态；
    *> fcadmin config –t initiator 0a
    *> fcadmin config –t target 0c     #修改回先前的端口状态；
15．*> disk show –v   #查看新机头的Local System ID: 118070115
16．切换到另一个机头Fas3070b(takeover)*> disk reassign -s <old sys-id> -d <new sys-id>   #旧ID为被更换机头的system ID，此处为fas3070a  (118053061)
17．*> halt
18．Loader> autoboot
19．waiting giveback....状态。
20．Fas3070b(takeover)*> cf giveback　或者　cf giveback –f   #强制giveback
21．最后再做一个autosupport    #换的哪一个就在哪一个上面autosupport；
```
## CompactFlash更换或者更新：
```
引导的过程：loader-->compactflash-->root vol  (loader是在主板上)
config http server; download 824_q_netboot.tgz 824_q_image.tgz

fas2240a>version
fas2240a>rdfile /etc/rc
fas2240a>rdfile /etc/hosts
fas2240a>cf status

fas2240b>version
fas2240b>rdfile /etc/rc
fas2240b>rdfile /etc/hosts
fas2240b>cf status

fas2240b>options cf.giveback.auto.enable off
fas2240b>cf takeover

# console to fas2240a
Loader> ifconfig e0M -addr=192.168.6.29 -mask=255.255.255.0 up
Loader> netboot http://192.168.6.42/netboot/kernel

# partner node
fas2240b>restore_backup 192.168.6.29
fas2240b>cf giveback
version -b
version
```